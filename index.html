<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mini Radio FM / iPod Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0f172a;
      --bg-dark: #020617;
      --primary: #38bdf8;
      --secondary: #22c55e;
      --accent: #f97316;
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --card: #111827;
      --border: #1f2937;
      --radius-xl: 18px;
    }

    /* Thème clair */
    body[data-theme="light"] {
      --bg: #e5e7eb;
      --bg-dark: #f9fafb;
      --primary: #2563eb;
      --secondary: #16a34a;
      --accent: #ea580c;
      --text: #020617;
      --text-muted: #6b7280;
      --card: #ffffff;
      --border: #d1d5db;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, var(--bg), var(--bg-dark));
      color: var(--text);
      transition: background 0.25s ease-out, color 0.25s ease-out;
    }

    .device {
      width: 320px;
      max-width: 92vw;
      background: linear-gradient(145deg, var(--card), var(--bg-dark));
      border-radius: 26px;
      padding: 16px 16px 20px;
      border: 1px solid var(--border);
      box-shadow:
        0 20px 45px rgba(0, 0, 0, 0.35),
        inset 0 0 0 1px rgba(148, 163, 184, 0.08);
      display: flex;
      flex-direction: column;
      gap: 14px;
      transition: background 0.25s ease-out, border-color 0.25s ease-out;
    }

    .device-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .logo {
      font-weight: 700;
      letter-spacing: 0.08em;
      font-size: 0.7rem;
      text-transform: uppercase;
      color: var(--primary);
    }

    .theme-toggle {
      border: none;
      background: rgba(15, 23, 42, 0.12);
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      cursor: pointer;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    body[data-theme="light"] .theme-toggle {
      background: rgba(148, 163, 184, 0.18);
    }

    .theme-toggle span {
      font-size: 0.85rem;
    }

    .screen {
      background: radial-gradient(circle at top left, var(--card), var(--bg-dark));
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      padding: 10px 12px;
      box-shadow:
        inset 0 0 0 1px rgba(15, 23, 42, 0.35),
        0 12px 24px rgba(0, 0, 0, 0.35);
      transition: background 0.25s ease-out, border-color 0.25s ease-out;
    }

    body[data-theme="light"] .screen {
      box-shadow:
        inset 0 0 0 1px rgba(148, 163, 184, 0.25),
        0 12px 24px rgba(15, 23, 42, 0.18);
    }

    .tabs {
      display: flex;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      padding: 3px;
      margin-bottom: 8px;
      gap: 4px;
    }

    body[data-theme="light"] .tabs {
      background: rgba(209, 213, 219, 0.95);
    }

    .tab {
      flex: 1;
      text-align: center;
      font-size: 0.7rem;
      padding: 4px 0;
      border-radius: 999px;
      cursor: pointer;
      user-select: none;
      color: var(--text-muted);
      transition: all 0.15s ease-out;
    }

    .tab.active {
      background: linear-gradient(135deg, var(--primary), #6366f1);
      color: #0b1120;
      font-weight: 600;
      box-shadow: 0 0 12px rgba(56, 189, 248, 0.5);
    }

    .screen-body {
      min-height: 140px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    /* HERO (LOGO RADIO / POCHETTE ALBUM / WEBRADIO) */

    .screen-hero {
      width: 100%;
      height: 70px;
      border-radius: 14px;
      background: radial-gradient(circle at 20% 20%, #1f2937, #020617);
      border: 1px solid rgba(15, 23, 42, 0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 4px;
      overflow: hidden;
    }

    body[data-theme="light"] .screen-hero {
      background: radial-gradient(circle at 20% 20%, #e5e7eb, #cbd5f5);
      border-color: rgba(148, 163, 184, 0.7);
    }

    .hero-inner {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px 10px;
      gap: 10px;
    }

    .radio-logo-frame,
    .album-frame,
    .webradio-logo-frame {
      width: 68px;
      height: 68px;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.45);
      background: #020617;
      flex-shrink: 0;
    }

    body[data-theme="light"] .radio-logo-frame,
    body[data-theme="light"] .album-frame,
    body[data-theme="light"] .webradio-logo-frame {
      box-shadow: 0 8px 16px rgba(15, 23, 42, 0.35);
    }

    .radio-logo,
    .album-cover,
    .webradio-logo {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .hero-text {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 2px;
    }

    .hero-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .hero-sub {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 0.8rem;
    }

    .mode-title {
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--text);
    }

    .subtitle {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    /* RADIO FM UI */
    .fm-frequency {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 4px;
    }

    .freq-display {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .freq-main {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 0.05em;
    }

    .freq-main span {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-left: 2px;
      font-weight: 400;
    }

    .station-name {
      font-size: 0.8rem;
      color: var(--primary);
      font-weight: 500;
    }

    .freq-slider {
      width: 100%;
      margin-top: 4px;
    }

    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      background: transparent;
    }

    input[type="range"]:focus {
      outline: none;
    }

    input[type="range"]::-webkit-slider-runnable-track {
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 999px;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #f9fafb;
      border: 2px solid #0f172a;
      margin-top: -5px;
      box-shadow: 0 0 6px rgba(59, 130, 246, 0.8);
    }

    input[type="range"]::-moz-range-track {
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 999px;
    }

    input[type="range"]::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #f9fafb;
      border: 2px solid #0f172a;
      box-shadow: 0 0 6px rgba(59, 130, 246, 0.8);
    }

    .rds-info {
      margin-top: 2px;
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .rds-tag {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.4);
      font-size: 0.65rem;
      color: var(--primary);
    }

    /* MUSIC UI */

    .track-info {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      align-items: center;
    }

    .track-text {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .track-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .track-artist {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .track-meta {
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      margin-top: 2px;
    }

    .playlist {
      margin-top: 6px;
      border-top: 1px solid rgba(15, 23, 42, 0.35);
      padding-top: 4px;
      max-height: 55px;
      overflow-y: auto;
      scrollbar-width: thin;
    }

    body[data-theme="light"] .playlist {
      border-top-color: rgba(148, 163, 184, 0.6);
    }

    .playlist-item {
      font-size: 0.75rem;
      padding: 3px 6px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      margin-bottom: 2px;
      color: var(--text-muted);
      transition: background 0.12s ease-out, color 0.12s ease-out;
    }

    .playlist-item span:first-child {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 160px;
    }

    .playlist-item.active {
      background: rgba(56, 189, 248, 0.12);
      color: var(--primary);
      font-weight: 500;
    }

    /* ÉGALISEUR */
    .eq-section {
      margin-top: 6px;
      border-top: 1px solid rgba(15, 23, 42, 0.35);
      padding-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    body[data-theme="light"] .eq-section {
      border-top-color: rgba(148, 163, 184, 0.6);
    }

    .eq-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.7rem;
      color: var(--text-muted);
      gap: 6px;
    }

    #eq-preset {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: transparent;
      color: var(--text-muted);
      max-width: 120px;
    }

    .eq-bands {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 4px;
    }

    .eq-band {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      width: 18%;
    }

    .eq-slider {
      writing-mode: bt-lr;
      -webkit-appearance: slider-vertical;
      height: 50px;
      width: 100%;
      margin: 0;
    }

    .eq-label {
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    /* VISUALIZER */
    .viz-section {
      margin-top: 6px;
      border-top: 1px solid rgba(15, 23, 42, 0.35);
      padding-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    body[data-theme="light"] .viz-section {
      border-top-color: rgba(148, 163, 184, 0.6);
    }

    .viz-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.7rem;
      color: var(--text-muted);
      gap: 6px;
    }

    #viz-mode {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: transparent;
      color: var(--text-muted);
      max-width: 120px;
    }

    #viz-canvas {
      width: 100%;
      height: 40px;
      border-radius: 8px;
      background: rgba(15, 23, 42, 0.9);
    }

    body[data-theme="light"] #viz-canvas {
      background: rgba(229, 231, 235, 0.9);
    }

    /* WEB RADIO */
    .webradio-list {
      margin-top: 6px;
      border-top: 1px solid rgba(15, 23, 42, 0.35);
      padding-top: 4px;
      max-height: 80px;
      overflow-y: auto;
      scrollbar-width: thin;
    }

    body[data-theme="light"] .webradio-list {
      border-top-color: rgba(148, 163, 184, 0.6);
    }

    .webradio-item {
      font-size: 0.75rem;
      padding: 3px 6px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      margin-bottom: 3px;
      color: var(--text-muted);
      transition: background 0.12s ease-out, color 0.12s ease-out;
    }

    .webradio-name {
      font-weight: 500;
    }

    .webradio-desc {
      font-size: 0.7rem;
    }

    .webradio-item.active {
      background: rgba(34, 197, 94, 0.12);
      color: var(--secondary);
    }

    .webradio-item.active .webradio-name {
      color: var(--secondary);
    }

    .webradio-item.active .webradio-desc {
      color: var(--text-muted);
    }

    /* CONTROLS (CLICK WHEEL) */

    .controls {
      margin-top: 6px;
      display: flex;
      justify-content: center;
    }

    .wheel {
      width: 170px;
      height: 170px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, var(--card), var(--bg-dark));
      box-shadow:
        inset 0 0 0 1px rgba(15, 23, 42, 0.9),
        0 14px 28px rgba(0, 0, 0, 0.7);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.25s ease-out, box-shadow 0.25s ease-out;
    }

    body[data-theme="light"] .wheel {
      background: radial-gradient(circle at 30% 20%, #f3f4f6, #e5e7eb);
      box-shadow:
        inset 0 0 0 1px rgba(148, 163, 184, 0.7),
        0 14px 28px rgba(15, 23, 42, 0.25);
    }

    .wheel-button {
      position: absolute;
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      cursor: pointer;
      user-select: none;
      padding: 2px 6px;
    }

    .wheel-button:hover {
      color: var(--primary);
    }

    .wheel-button.top {
      top: 16px;
    }

    .wheel-button.bottom {
      bottom: 16px;
    }

    .wheel-button.left {
      left: 20px;
    }

    .wheel-button.right {
      right: 20px;
    }

    .wheel-center {
      width: 70px;
      height: 70px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #0b1120, #020617);
      box-shadow: 0 0 0 1px rgba(30, 64, 175, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      font-size: 0.8rem;
      color: #e5e7eb;
      font-weight: 600;
      transition: background 0.25s ease-out, box-shadow 0.25s ease-out;
    }

    body[data-theme="light"] .wheel-center {
      background: radial-gradient(circle at 30% 20%, #ffffff, #e5e7eb);
      color: #020617;
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.6);
    }

    .status-row {
      margin-top: 4px;
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
    }

    .battery {
      height: 10px;
      width: 26px;
      border-radius: 4px;
      border: 1px solid var(--text-muted);
      position: relative;
      display: inline-flex;
      align-items: center;
      padding: 1px;
    }

    .battery::after {
      content: "";
      position: absolute;
      right: -4px;
      width: 3px;
      height: 6px;
      border-radius: 2px;
      background: var(--text-muted);
    }

    .battery-level {
      height: 100%;
      width: 60%;
      border-radius: 3px;
      background: linear-gradient(90deg, var(--secondary), var(--accent));
    }

    .pill {
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    /* Responsive mobile plus serré */
    @media (max-width: 360px) {
      .device {
        padding: 12px 10px 14px;
        border-radius: 20px;
      }
      .screen-hero {
        height: 60px;
      }
      .radio-logo-frame,
      .album-frame,
      .webradio-logo-frame {
        width: 56px;
        height: 56px;
      }
      .hero-title {
        font-size: 0.8rem;
      }
      .hero-sub {
        font-size: 0.7rem;
      }
      .freq-main {
        font-size: 1.4rem;
      }
      .wheel {
        width: 150px;
        height: 150px;
      }
      .wheel-center {
        width: 64px;
        height: 64px;
        font-size: 0.75rem;
      }
      .playlist {
        max-height: 48px;
      }
      #viz-canvas {
        height: 36px;
      }
    }
  </style>
</head>
<body data-theme="dark">
  <div class="device">
    <div class="device-header">
      <div class="logo">neoFM</div>
      <button class="theme-toggle" id="theme-toggle" type="button">
        <span id="theme-icon">☾</span>
        <span id="theme-label">Sombre</span>
      </button>
    </div>

    <div class="screen">
      <div class="tabs">
        <div class="tab active" data-tab="radio">Radio FM</div>
        <div class="tab" data-tab="music">Musique</div>
        <div class="tab" data-tab="webradio">Web Radio</div>
      </div>

      <!-- RADIO FM -->
      <div class="screen-body" id="screen-radio">
        <div class="screen-hero">
          <div class="hero-inner">
            <div class="radio-logo-frame">
              <img
                id="radio-logo"
                src="img/radio-default.png"
                alt="Logo radio"
                class="radio-logo"
              />
            </div>
            <div class="hero-text">
              <div class="hero-title" id="radio-hero-title">Nova Mix</div>
              <div class="hero-sub" id="radio-hero-sub">100% hits &amp; news</div>
            </div>
          </div>
        </div>

        <div class="title-row">
          <div>
            <div class="mode-title">Radio FM</div>
            <div class="subtitle">Tuner numérique • RDS (simulé)</div>
          </div>
          <div class="pill">Stéréo</div>
        </div>

        <div class="fm-frequency">
          <div class="freq-display">
            <div class="freq-main" id="freq-value">
              99.3<span>MHz</span>
            </div>
            <div class="station-name" id="station-name">Nova Mix</div>
          </div>
          <input
            id="freq-slider"
            type="range"
            min="875"
            max="1080"
            value="993"
            step="1"
            class="freq-slider"
          />
          <div class="rds-info">
            <div id="rds-text">100% hits & news</div>
            <div class="rds-tag">RDS</div>
          </div>
        </div>
      </div>

      <!-- MUSIQUE LOCALE -->
      <div class="screen-body" id="screen-music" style="display: none;">
        <div class="screen-hero">
          <div class="hero-inner">
            <div class="album-frame">
              <img
                id="album-cover"
                src="img/cover-default.jpg"
                alt="Pochette album"
                class="album-cover"
              />
            </div>
            <div class="hero-text">
              <div class="hero-title" id="hero-track-title">Titre 1</div>
              <div class="hero-sub" id="hero-track-artist">Artiste inconnu</div>
            </div>
          </div>
        </div>

        <div class="title-row">
          <div>
            <div class="mode-title">Musique</div>
            <div class="subtitle">Bibliothèque locale</div>
          </div>
          <div class="pill" id="music-mode-label">Lecture</div>
        </div>

        <div class="track-info">
          <div class="track-text">
            <div class="track-title" id="track-title">Titre 1</div>
            <div class="track-artist" id="track-artist">Artiste inconnu</div>
            <div class="track-meta">
              <span id="track-time">0:00</span>
              <span id="track-index">1 / 3</span>
            </div>
          </div>
        </div>

        <div class="playlist" id="playlist"></div>

        <!-- ÉGALISEUR RÉEL + PRESETS -->
        <div class="eq-section">
          <div class="eq-header">
            <span id="eq-status">Preset : Flat</span>
            <select id="eq-preset">
              <option value="flat">Flat</option>
              <option value="rock">Rock</option>
              <option value="pop">Pop</option>
              <option value="bass">Bass</option>
              <option value="vocal">Vocal</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="eq-bands">
            <div class="eq-band">
              <input
                type="range"
                min="-12"
                max="12"
                value="0"
                step="1"
                class="eq-slider"
                data-index="0"
              />
              <div class="eq-label">60Hz</div>
            </div>
            <div class="eq-band">
              <input
                type="range"
                min="-12"
                max="12"
                value="0"
                step="1"
                class="eq-slider"
                data-index="1"
              />
              <div class="eq-label">230Hz</div>
            </div>
            <div class="eq-band">
              <input
                type="range"
                min="-12"
                max="12"
                value="0"
                step="1"
                class="eq-slider"
                data-index="2"
              />
              <div class="eq-label">910Hz</div>
            </div>
            <div class="eq-band">
              <input
                type="range"
                min="-12"
                max="12"
                value="0"
                step="1"
                class="eq-slider"
                data-index="3"
              />
              <div class="eq-label">3.6k</div>
            </div>
            <div class="eq-band">
              <input
                type="range"
                min="-12"
                max="12"
                value="0"
                step="1"
                class="eq-slider"
                data-index="4"
              />
              <div class="eq-label">14k</div>
            </div>
          </div>
        </div>

        <!-- VISUALIZER -->
        <div class="viz-section">
          <div class="viz-header">
            <span>Visualizer</span>
            <select id="viz-mode">
              <option value="off">Off</option>
              <option value="bars">Barres</option>
              <option value="wave">Onde</option>
            </select>
          </div>
          <canvas id="viz-canvas" width="260" height="40"></canvas>
        </div>
      </div>

      <!-- WEB RADIO (FLUX RÉELS) -->
      <div class="screen-body" id="screen-webradio" style="display: none;">
        <div class="screen-hero">
          <div class="hero-inner">
            <div class="webradio-logo-frame">
              <img
                id="webradio-logo"
                src="img/radio-default.png"
                alt="Logo web radio"
                class="webradio-logo"
              />
            </div>
            <div class="hero-text">
              <div class="hero-title" id="webradio-title">Choisis une station</div>
              <div class="hero-sub" id="webradio-sub">Web radio internet</div>
            </div>
          </div>
        </div>

        <div class="title-row">
          <div>
            <div class="mode-title">Web Radio</div>
            <div class="subtitle">Flux HTTP / MP3</div>
          </div>
          <div class="pill" id="webradio-status">Stop</div>
        </div>

        <div class="webradio-list" id="webradio-list"></div>
      </div>
    </div>

    <!-- WHEEL -->
    <div class="controls">
      <div class="wheel">
        <div class="wheel-button top" id="btn-menu">Menu</div>
        <div class="wheel-button bottom" id="btn-play">Play/Pause</div>
        <div class="wheel-button left" id="btn-prev">◀◀</div>
        <div class="wheel-button right" id="btn-next">▶▶</div>
        <div class="wheel-center" id="btn-center">OK</div>
      </div>
    </div>

    <div class="status-row">
      <div>Mode : <span id="status-mode">Radio FM</span></div>
      <div>
        <span class="battery">
          <span class="battery-level" id="battery-level"></span>
        </span>
      </div>
    </div>

    <!-- Lecteur audio invisible -->
    <audio id="audio-player"></audio>
  </div>

  <script>
    // -------------------------
    // GESTION THÈME CLAIR / SOMBRE
    // -------------------------
    const themeToggle = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");
    const themeLabel = document.getElementById("theme-label");

    function applyTheme(theme) {
      document.body.setAttribute("data-theme", theme);
      if (theme === "light") {
        themeIcon.textContent = "☀";
        themeLabel.textContent = "Clair";
      } else {
        themeIcon.textContent = "☾";
        themeLabel.textContent = "Sombre";
      }
      try {
        localStorage.setItem("neo-theme", theme);
      } catch (e) {}
    }

    (function () {
      let saved = null;
      try {
        saved = localStorage.getItem("neo-theme");
      } catch (e) {}
      if (saved === "light" || saved === "dark") {
        applyTheme(saved);
      } else {
        applyTheme("dark");
      }
    })();

    themeToggle.addEventListener("click", () => {
      const current = document.body.getAttribute("data-theme") || "dark";
      applyTheme(current === "dark" ? "light" : "dark");
    });

    // -------------------------
    // LOGIQUE GÉNÉRALE
    // -------------------------
    const tabs = document.querySelectorAll(".tab");
    const screenRadio = document.getElementById("screen-radio");
    const screenMusic = document.getElementById("screen-music");
    const screenWebradio = document.getElementById("screen-webradio");
    const statusMode = document.getElementById("status-mode");
    const audio = document.getElementById("audio-player");
audio.crossOrigin = "anonymous";

    let mode = "radio"; // "radio" | "music" | "webradio"
    const tabOrder = ["radio", "music", "webradio"];
    let currentTabIndex = 0;

    let currentTrackIndex = 0;
    let currentWebRadioIndex = 0;
    let isPlaying = false;
    let battery = 0.7;

    // Web Audio / Égaliseur / Visualizer
    let currentFMStation = null;
    let audioContext = null;
    let sourceNode = null;
    let eqFilters = [];
    let analyser = null;
    let vizDataArray = null;
    let vizBufferLength = 0;
    let vizMode = "off";

    const eqFrequencies = [60, 230, 910, 3600, 14000];

    const vizCanvas = document.getElementById("viz-canvas");
    const vizCtx = vizCanvas.getContext("2d");
    const vizModeSelect = document.getElementById("viz-mode");

    const eqSliders = document.querySelectorAll(".eq-slider");
    const eqPresetSelect = document.getElementById("eq-preset");
    const eqStatus = document.getElementById("eq-status");

    const eqPresets = {
      flat: [0, 0, 0, 0, 0],
      rock: [4, 3, 1, 3, 4],
      pop: [2, 3, 4, 2, 1],
      bass: [6, 4, 1, -1, -2],
      vocal: [-1, 0, 3, 4, 3],
      custom: null,
    };

    function ensureAudioContext() {
      if (audioContext) return;
      const AC = window.AudioContext || window.webkitAudioContext;
      if (!AC) return;
      audioContext = new AC();
      sourceNode = audioContext.createMediaElementSource(audio);

      // Filtres EQ
      eqFilters = eqFrequencies.map((freq) => {
        const filter = audioContext.createBiquadFilter();
        filter.type = "peaking";
        filter.frequency.value = freq;
        filter.Q.value = 1.2;
        filter.gain.value = 0;
        return filter;
      });

      // Analyser
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 256;
      vizBufferLength = analyser.frequencyBinCount;
      vizDataArray = new Uint8Array(vizBufferLength);

      // Chaînage : source -> EQs -> analyser -> destination
      let node = sourceNode;
      eqFilters.forEach((f) => {
        node.connect(f);
        node = f;
      });
      node.connect(analyser);
      analyser.connect(audioContext.destination);

      startVisualizerLoop();
    }

    function startVisualizerLoop() {
      function draw() {
        requestAnimationFrame(draw);

        if (!analyser || !vizCtx) return;

        const width = vizCanvas.width;
        const height = vizCanvas.height;

        // Efface avec léger fondu
        vizCtx.fillStyle = getComputedStyle(document.body).getPropertyValue(
          "--bg-dark"
        );
        vizCtx.globalAlpha = 0.9;
        vizCtx.fillRect(0, 0, width, height);
        vizCtx.globalAlpha = 1;

        if (vizMode === "off" || !isPlaying || mode === "radio") {
          return;
        }

        if (vizMode === "bars") {
          analyser.getByteFrequencyData(vizDataArray);

          const barCount = 32;
          const step = Math.floor(vizBufferLength / barCount);
          const barWidth = width / barCount;

          for (let i = 0; i < barCount; i++) {
            let sum = 0;
            for (let j = 0; j < step; j++) {
              sum += vizDataArray[i * step + j];
            }
            const value = sum / step;
            const barHeight = (value / 255) * height;

            const x = i * barWidth;
            const y = height - barHeight;

            vizCtx.fillStyle = "#38bdf8";
            vizCtx.fillRect(x, y, barWidth * 0.8, barHeight);
          }
        } else if (vizMode === "wave") {
          analyser.getByteTimeDomainData(vizDataArray);

          vizCtx.lineWidth = 2;
          vizCtx.strokeStyle = "#f97316";
          vizCtx.beginPath();

          const sliceWidth = width / vizBufferLength;
          let x = 0;

          for (let i = 0; i < vizBufferLength; i++) {
            const v = vizDataArray[i] / 255;
            const y = v * height;

            if (i === 0) {
              vizCtx.moveTo(x, y);
            } else {
              vizCtx.lineTo(x, y);
            }

            x += sliceWidth;
          }

          vizCtx.stroke();
        }
      }

      draw();
    }

    vizModeSelect.addEventListener("change", (e) => {
      vizMode = e.target.value;
    });

    function applyEqPreset(name) {
  const gains = eqPresets[name];
  if (!gains) return;

  eqStatus.textContent =
    "Preset : " + name.charAt(0).toUpperCase() + name.slice(1);

  eqSliders.forEach((slider, i) => {
    const g = gains[i] ?? 0;
    slider.value = g;

    // Si l'audioContext existe déjà, on applique aussi aux filtres.
    if (audioContext && eqFilters[i]) {
      eqFilters[i].gain.value = g;
    }
  });
}


    eqPresetSelect.addEventListener("change", (e) => {
      const value = e.target.value;
      if (value === "custom") {
        eqStatus.textContent = "Preset : Custom";
        return;
      }
      applyEqPreset(value);
    });

    // sliders -> Custom
    eqSliders.forEach((slider) => {
      slider.addEventListener("input", (e) => {
        const index = parseInt(e.target.dataset.index, 10);
        const gain = parseInt(e.target.value, 10);
        if (eqPresetSelect.value !== "custom") {
          eqPresetSelect.value = "custom";
          eqStatus.textContent = "Preset : Custom";
        }
        if (!eqFilters[index]) return;
        eqFilters[index].gain.value = gain;
      });
    });

    // -------------------------
    // ONGLET / MODE
    // -------------------------
    function showTab(tabName) {
      mode = tabName;
      currentTabIndex = tabOrder.indexOf(tabName);

      tabs.forEach((t) => {
        t.classList.toggle("active", t.getAttribute("data-tab") === tabName);
      });

      screenRadio.style.display = tabName === "radio" ? "flex" : "none";
      screenMusic.style.display = tabName === "music" ? "flex" : "none";
      screenWebradio.style.display = tabName === "webradio" ? "flex" : "none";

      if (mode === "radio") statusMode.textContent = "Radio FM";
      if (mode === "music") statusMode.textContent = "Musique";
      if (mode === "webradio") statusMode.textContent = "Web Radio";
    }

    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        showTab(tab.getAttribute("data-tab"));
      });
    });

    showTab("radio");

    // -------------------------
    // RADIO FM (SIMULÉE) + LOGOS
    // -------------------------
    const freqSlider = document.getElementById("freq-slider");
    const freqValue = document.getElementById("freq-value");
    const stationName = document.getElementById("station-name");
    const rdsText = document.getElementById("rds-text");
    const radioLogo = document.getElementById("radio-logo");
    const radioHeroTitle = document.getElementById("radio-hero-title");
    const radioHeroSub = document.getElementById("radio-hero-sub");

    const fmStations = [
  {
    freq: 881,
    name: "France Inter",
    rds: "Radio France • généraliste",
    url: "https://icecast.radiofrance.fr/franceinter-midfi.mp3"
  },
  {
    freq: 915,
    name: "franceinfo:",
    rds: "Info en continu",
    url: "https://icecast.radiofrance.fr/franceinfo-midfi.mp3"
  },
  {
    freq: 943,
    name: "Fun Radio",
    rds: "Le son dancefloor",
    url: "http://icecast.funradio.fr/fun-1-44-128"
  },
  {
    freq: 979,
    name: "NRJ",
    rds: "Hit Music Only",
    url: "http://streaming.nrjaudio.fm/nrj-mobile.mp3"
  },
  {
    freq: 993,
    name: "RTL",
    rds: "Talk / actualité",
    url: "http://icecast.rtl.fr/rtl-1-44-128"
  },
  {
    freq: 1025,
    name: "Europe 1",
    rds: "Info & talk",
    url: "http://ais-live.cloud-services.paris:8000/europe1.mp3"
  },
  {
    freq: 1062,
    name: "Skyrock",
    rds: "Premier sur le rap",
    url: "http://icecast.skyrock.net/s/natio_mp3_128k"
  }
];

const stationLogos = {
  "France Inter": "img/webradio-franceinter.png",
  "franceinfo:": "img/webradio-franceinfo.png",
  "Fun Radio": "img/webradio-funradio.png",
  "NRJ": "img/webradio-nrj.png",
  "RTL": "img/webradio-rtl.png",
  "Europe 1": "img/webradio-europe1.png",
  "Skyrock": "img/webradio-skyrock.png",
  Bruitage: "img/radio-default.png"
};
function updateFrequencyDisplay(value) {
  const mhz = (value / 10).toFixed(1);
  freqValue.innerHTML = mhz + '<span>MHz</span>';

  let closest = fmStations[0];
  let minDiff = Math.abs(value - fmStations[0].freq);
  for (let i = 1; i < fmStations.length; i++) {
    const diff = Math.abs(value - fmStations[i].freq);
    if (diff < minDiff) {
      minDiff = diff;
      closest = fmStations[i];
    }
  }

  if (minDiff <= 4) {
    // On est "locké" sur une vraie station
    currentFMStation = closest;

    stationName.textContent = closest.name;
    rdsText.textContent = closest.rds;
    radioHeroTitle.textContent = closest.name;
    radioHeroSub.textContent = closest.rds;
    const logoSrc = stationLogos[closest.name] || stationLogos.Bruitage;
    radioLogo.src = logoSrc;
  } else {
    // Bruitage / hors station
    currentFMStation = null;

    stationName.textContent = "Bruitage";
    rdsText.textContent = "Hors station";
    radioHeroTitle.textContent = "Aucune station";
    radioHeroSub.textContent = "Tourne le tuner…";
    radioLogo.src = stationLogos.Bruitage;
  }
}

    

    

    freqSlider.addEventListener("input", (e) => {
      updateFrequencyDisplay(parseInt(e.target.value, 10));
    });

    updateFrequencyDisplay(parseInt(freqSlider.value, 10));

    // -------------------------
    // MUSIQUE + POCHETTES
    // -------------------------
    const playlistEl = document.getElementById("playlist");
    const trackTitleEl = document.getElementById("track-title");
    const trackArtistEl = document.getElementById("track-artist");
    const trackTimeEl = document.getElementById("track-time");
    const trackIndexEl = document.getElementById("track-index");
    const musicModeLabel = document.getElementById("music-mode-label");
    const heroTrackTitle = document.getElementById("hero-track-title");
    const heroTrackArtist = document.getElementById("hero-track-artist");
    const albumCoverEl = document.getElementById("album-cover");

    const tracks = [
      {
        title: "Morning Drive",
        artist: "Unknown",
        file: "audio/track1.mp3",
        duration: "3:21",
        cover: "img/cover1.jpg",
      },
      {
        title: "City Lights",
        artist: "Unknown",
        file: "audio/track2.mp3",
        duration: "4:02",
        cover: "img/cover2.jpg",
      },
      {
        title: "Night Session",
        artist: "Unknown",
        file: "audio/track3.mp3",
        duration: "2:58",
        cover: "img/cover3.jpg",
      },
    ];

    function renderPlaylist() {
      playlistEl.innerHTML = "";
      tracks.forEach((track, index) => {
        const item = document.createElement("div");
        item.className = "playlist-item";
        if (index === currentTrackIndex) {
          item.classList.add("active");
        }
        item.dataset.index = index;
        item.innerHTML =
          "<span>" +
          track.title +
          "</span><span>" +
          track.duration +
          "</span>";
        item.addEventListener("click", () => {
          loadTrack(index);
          playAudioMusic();
        });
        playlistEl.appendChild(item);
      });
    }

    function loadTrack(index) {
      if (index < 0) index = tracks.length - 1;
      if (index >= tracks.length) index = 0;

      currentTrackIndex = index;
      const track = tracks[index];
      audio.src = track.file;

      trackTitleEl.textContent = track.title;
      trackArtistEl.textContent = track.artist;
      heroTrackTitle.textContent = track.title;
      heroTrackArtist.textContent = track.artist;
      trackIndexEl.textContent = index + 1 + " / " + tracks.length;

      albumCoverEl.src = track.cover || "img/cover-default.jpg";

      const items = playlistEl.querySelectorAll(".playlist-item");
      items.forEach((item, i) => {
        item.classList.toggle("active", i === index);
      });
    }

    function playAudioMusic() {
      ensureAudioContext();
      if (!audio.src) {
        loadTrack(currentTrackIndex);
      }
      if (audioContext) {
        audioContext.resume().catch(() => {});
      }
      audio.play().catch(() => {});
      isPlaying = true;
      musicModeLabel.textContent = "Lecture";
    }

    function pauseAudioMusic() {
      audio.pause();
      isPlaying = false;
      musicModeLabel.textContent = "Pause";
    }

    audio.addEventListener("timeupdate", () => {
      if (audio.duration) {
        const minutes = Math.floor(audio.currentTime / 60);
        const seconds = Math.floor(audio.currentTime % 60)
          .toString()
          .padStart(2, "0");
        trackTimeEl.textContent = minutes + ":" + seconds;
      }
    });

    audio.addEventListener("ended", () => {
      if (mode === "music") {
        nextTrack();
      }
    });

    function nextTrack() {
      loadTrack(currentTrackIndex + 1);
      if (mode === "music" && isPlaying) playAudioMusic();
    }

    function prevTrack() {
      loadTrack(currentTrackIndex - 1);
      if (mode === "music" && isPlaying) playAudioMusic();
    }

    renderPlaylist();
    loadTrack(currentTrackIndex);
    applyEqPreset("flat");

    // -------------------------
    // WEB RADIO (vraies URL)
    // -------------------------
    const webradioListEl = document.getElementById("webradio-list");
    const webradioLogoEl = document.getElementById("webradio-logo");
    const webradioTitleEl = document.getElementById("webradio-title");
    const webradioSubEl = document.getElementById("webradio-sub");
    const webradioStatusEl = document.getElementById("webradio-status");

    const webRadios = [
      {
        id: "france-inter",
        name: "France Inter",
        description: "Radio France • généraliste",
        url: "	https://icecast.radiofrance.fr/franceinter-midfi.mp3",
      },
      {
        id: "france-info",
        name: "franceinfo:",
        description: "Info en continu",
        url: "http://direct.franceinfo.fr/live/franceinfo-midfi.mp3",
      },
      {
        id: "fun-radio",
        name: "Fun Radio",
        description: "Le son dancefloor",
        url: "http://icecast.funradio.fr/fun-1-44-128",
      },
      {
        id: "nrj",
        name: "NRJ",
        description: "Hit Music Only",
        url: "http://streaming.nrjaudio.fm/nrj-mobile.mp3",
      },
      {
        id: "rtl",
        name: "RTL",
        description: "Talk / actualité",
        url: "http://icecast.rtl.fr/rtl-1-44-128",
      },
      {
        id: "europe1",
        name: "Europe 1",
        description: "Info & talk",
        url: "http://ais-live.cloud-services.paris:8000/europe1.mp3",
      },
      {
        id: "skyrock",
        name: "Skyrock",
        description: "Premier sur le rap",
        url: "http://icecast.skyrock.net/s/natio_mp3_128k",
      },
      {
        id: "ouifm",
        name: "OUI FM",
        description: "La radio du rock",
        url: "http://stream.ouifm.fr/ouifm-high.mp3",
      },
    ];

    const webRadioLogos = {
      "France Inter": "img/webradio-franceinter.png",
      "franceinfo:": "img/webradio-franceinfo.png",
      "Fun Radio": "img/webradio-funradio.png",
      "NRJ": "img/webradio-nrj.png",
      "RTL": "img/webradio-rtl.png",
      "Europe 1": "img/webradio-europe1.png",
      "Skyrock": "img/webradio-skyrock.png",
      "OUI FM": "img/webradio-ouifm.png",
      default: "img/radio-default.png",
    };

    function renderWebRadioList() {
      webradioListEl.innerHTML = "";
      webRadios.forEach((st, index) => {
        const item = document.createElement("div");
        item.className = "webradio-item";
        if (index === currentWebRadioIndex) {
          item.classList.add("active");
        }
        item.dataset.index = index;
        item.innerHTML =
          '<div class="webradio-name">' +
          st.name +
          "</div><div class=\"webradio-desc\">" +
          st.description +
          "</div>";
        item.addEventListener("click", () => {
          loadWebRadio(index);
          playWebRadio();
        });
        webradioListEl.appendChild(item);
      });
    }

    function updateWebRadioListActive() {
      const items = webradioListEl.querySelectorAll(".webradio-item");
      items.forEach((item, i) => {
        item.classList.toggle("active", i === currentWebRadioIndex);
      });
    }

    function loadWebRadio(index) {
      if (index < 0) index = webRadios.length - 1;
      if (index >= webRadios.length) index = 0;

      currentWebRadioIndex = index;
      const st = webRadios[index];
      audio.src = st.url;

      webradioTitleEl.textContent = st.name;
      webradioSubEl.textContent = st.description;
      const logoSrc = webRadioLogos[st.name] || webRadioLogos.default;
      webradioLogoEl.src = logoSrc;

      updateWebRadioListActive();
    }

    function playWebRadio() {
  // Pas de Web Audio ici pour éviter CORS / NetworkError
  if (!audio.src) {
    loadWebRadio(currentWebRadioIndex);
  }

  audio.play().then(() => {
    isPlaying = true;
    webradioStatusEl.textContent = "Lecture";
  }).catch((err) => {
    console.error("Erreur lecture WebRadio :", err);
    isPlaying = false;
    webradioStatusEl.textContent = "Erreur flux";
  });
}


    function pauseWebRadio() {
      audio.pause();
      isPlaying = false;
      webradioStatusEl.textContent = "Pause";
    }

    renderWebRadioList();
    loadWebRadio(currentWebRadioIndex);
function playFM() {
  if (!currentFMStation || !currentFMStation.url) {
    console.warn("[FM] Aucune station lockée ou pas d'URL");
    return;
  }

  audio.src = currentFMStation.url;
  audio.play().then(() => {
    console.log("[FM] Lecture :", currentFMStation.name, currentFMStation.url);
    isPlaying = true;
  }).catch((err) => {
    console.error("[FM] Erreur lecture :", err);
    isPlaying = false;
  });
}

function pauseFM() {
  audio.pause();
  isPlaying = false;
  console.log("[FM] Pause");
}

    // -------------------------
    // BOUTONS WHEEL
    // -------------------------
    const btnMenu = document.getElementById("btn-menu");
    const btnPlay = document.getElementById("btn-play");
    const btnNext = document.getElementById("btn-next");
    const btnPrev = document.getElementById("btn-prev");
    const btnCenter = document.getElementById("btn-center");

    btnMenu.addEventListener("click", () => {
      const nextIndex = (currentTabIndex + 1) % tabOrder.length;
      showTab(tabOrder[nextIndex]);
    });

    btnPlay.addEventListener("click", () => {
      if (mode === "radio") {
        return; // FM simulée, pas de vrai flux
      }
      if (mode === "music") {
        if (isPlaying) {
          pauseAudioMusic();
        } else {
          playAudioMusic();
        }
      } else if (mode === "webradio") {
        if (isPlaying) {
          pauseWebRadio();
        } else {
          playWebRadio();
        }
      }
    });

    btnPlay.addEventListener("click", () => {
  if (mode === "radio") {
    // Play/Pause FM
    if (isPlaying) {
      pauseFM();
    } else {
      playFM();
    }
    return;
  }

  if (mode === "music") {
    if (isPlaying) {
      pauseAudioMusic();
    } else {
      playAudioMusic();
    }
  } else if (mode === "webradio") {
    if (isPlaying) {
      pauseWebRadio();
    } else {
      playWebRadio();
    }
  }
});


    btnPrev.addEventListener("click", () => {
      if (mode === "radio") {
        const newVal = Math.max(
          parseInt(freqSlider.value, 10) - 2,
          parseInt(freqSlider.min, 10)
        );
        freqSlider.value = newVal;
        updateFrequencyDisplay(newVal);
      } else if (mode === "music") {
        prevTrack();
      } else if (mode === "webradio") {
        loadWebRadio(currentWebRadioIndex - 1);
        if (isPlaying) playWebRadio();
      }
    });

    btnCenter.addEventListener("click", () => {
  if (mode === "radio") {
    if (isPlaying) pauseFM();
    else playFM();
  } else if (mode === "music") {
    if (isPlaying) pauseAudioMusic();
    else playAudioMusic();
  } else if (mode === "webradio") {
    if (isPlaying) pauseWebRadio();
    else playWebRadio();
  }
});


    // -------------------------
    // BATTERIE (SIMULÉE)
    // -------------------------
    const batteryLevel = document.getElementById("battery-level");
    function updateBattery() {
      battery -= 0.0008;
      if (battery < 0.1) battery = 0.9;
      batteryLevel.style.width = Math.round(battery * 100) + "%";
    }
    setInterval(updateBattery, 2000);
    updateBattery();
  </script>
</body>
</html>
